<!DOCTYPE html>
<html lang="es">
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Simulador de Malla Curricular</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Rubik&display=swap');
    
    body {
      font-family: 'Rubik', sans-serif;
      padding: 20px;
    }
    #malla-container {
      position: relative;
    }
    #malla {
      display: flex;
      flex-direction: row;
      gap: 20px;
      overflow-x: auto;
      position: relative;
      z-index: 1;
    }
    .semestre {
      display: flex;
      flex-direction: column;
      align-items: center;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 10px;
      min-width: 200px;
      transition: background-color 0.3s ease;
      margin-right: 10px;
    }
    .asignatura {
      width: 90%;
      padding: 10px;
      margin: 5px 0;
      text-align: center;
      border: 2px solid #ccc;
      border-radius: 8px;
      cursor: pointer;
      background-color: #eee;
      transition: background-color 0.3s ease;
      position: relative;
      z-index: 2;
    }
    .asignatura:active {
      filter: brightness(1.2);
    }
    .aprobada {
      background-color: #b5f5b5;
      border-color: #5cb85c;
    }
    .bloqueada {
      background-color: #e0e0e0;
      border-color: #999;
      cursor: not-allowed;
    }
    .resumen {
      margin: 20px 0;
      font-weight: bold;
    }
    #controles {
      margin-bottom: 10px;
    }
    button {
      margin-right: 10px;
      padding: 5px 10px;
      cursor: pointer;
    }
    canvas {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 0;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <h1>Simulador de Malla Curricular</h1>
  <div id="controles">
    <button onclick="reiniciarMalla()">游댃 Reiniciar Malla</button>
  </div>
  <div class="resumen" id="resumen"></div>
  <div id="malla"></div>

  <script>
    const coloresSemestre = [
      "#fbe9e7", "#f3e5f5", "#e3f2fd", "#e8f5e9", "#fff3e0",
      "#fce4ec", "#ede7f6", "#f9fbe7", "#e0f2f1", "#f3e5f5"
    ];

    const malla = [
      [
        { nombre: "Principios Matem치ticos", id: "MAT015", prerreq: [] },
        { nombre: "Biolog칤a Celular", id: "BIO002", prerreq: [] },
        { nombre: "Qu칤mica General", id: "QUI001", prerreq: [] },
        { nombre: "Introducci칩n a la Tecnolog칤a M칠dica", id: "TME065", prerreq: [] },
        { nombre: "Taller de Competencias Comunicativas", id: "FGL149", prerreq: [] },
        { nombre: "Taller de Competencias para el Aprendizaje", id: "COM001", prerreq: [] },
        { nombre: "Taller de Desarrollo Personal I", id: "FGL001", prerreq: [] }
      ],
      [
        { nombre: "Biof칤sica", id: "FIS002", prerreq: [] },
        { nombre: "Proc. de Enfermer칤a y Primeros Auxilios", id: "ENF098", prerreq: [] },
        { nombre: "Qu칤mica Org치nica", id: "QUI002", prerreq: ["QUI001"] },
        { nombre: "Anatom칤a", id: "TME066", prerreq: [] },
        { nombre: "Histolog칤a", id: "TME135", prerreq: [] },
        { nombre: "Taller de Desarrollo Personal II", id: "FGL002", prerreq: ["FGL001"] },
        { nombre: "Cultura y Valores", id: "FGL003", prerreq: [] }
      ],
      [
        { nombre: "Estad칤stica para Ciencias de la Salud", id: "KIN118", prerreq: [] },
        { nombre: "Inmunolog칤a B치sica", id: "TME068", prerreq: [] },
        { nombre: "Fundamentos de la Bioqu칤mica", id: "TME060", prerreq: ["QUI002"] },
        { nombre: "Fisiolog칤a", id: "TME067", prerreq: ["TME066"] },
        { nombre: "Bioseguridad", id: "TME064", prerreq: [] },
        { nombre: "Persona y Sentido", id: "FGL135", prerreq: [] },
        { nombre: "Ingl칠s B치sico I", id: "FGL010", prerreq: [] }
      ],
      [
        { nombre: "Fundamentos en Salud P칰blica", id: "ENF109", prerreq: [] },
        { nombre: "칄tica en Salud", id: "ENF080", prerreq: [] },
        { nombre: "Bioqu칤mica Cl칤nica B치sica", id: "TME145", prerreq: ["TME060"] },
        { nombre: "Fisopatolog칤a", id: "TME070", prerreq: ["TME067"] },
        { nombre: "Gesti칩n de Calidad", id: "TME146", prerreq: [] },
        { nombre: "Ingl칠s B치sico II", id: "FGL011", prerreq: ["FGL010"] }
      ],
      [
        { nombre: "Parasitolog칤a Cl칤nica", id: "TME080", prerreq: ["TME070"] },
        { nombre: "Microbiolog칤a B치sica", id: "TME147", prerreq: ["TME070"] },
        { nombre: "Bioqu칤mica Cl칤nica Aplicada", id: "TME169", prerreq: ["TME145"] },
        { nombre: "Inmunolog칤a Cl칤nica", id: "TME074", prerreq: ["TME068"] },
        { nombre: "Gesti칩n de Calidad y Adm. de Laboratorio", id: "TME150", prerreq: ["TME146"] }
      ],
      [
        { nombre: "Microbiolog칤a Cl칤nica", id: "TME077", prerreq: ["TME147"] },
        { nombre: "Diagn칩stico Molecular", id: "TME078", prerreq: ["TME077"] }
      ],
      [
        { nombre: "Inmunohematolog칤a", id: "TME060H", prerreq: ["TME080"] },
        { nombre: "Hematolog칤a B치sica", id: "TME076", prerreq: ["TME070"] },
        { nombre: "Integrado Cl칤nico I", id: "TME170", prerreq: ["TME074", "TME169"] }
      ],
      [
        { nombre: "Medicina Transfusional", id: "TME149", prerreq: ["TME060H"] },
        { nombre: "Hematolog칤a Cl칤nica", id: "TME150B", prerreq: ["TME076"] },
        { nombre: "Metodolog칤a de la Investigaci칩n", id: "TME142", prerreq: ["KIN118"] },
        { nombre: "Electivo I", id: "TMEEL1", prerreq: [] },
        { nombre: "Electivo II", id: "TMEEL2", prerreq: [] },
        { nombre: "Electivo III", id: "TMEEL3", prerreq: [] }
      ],
      [
        { nombre: "Gesti칩n en Salud", id: "ENF079", prerreq: [] },
        { nombre: "Seminario de Investigaci칩n", id: "TME160", prerreq: ["TME142"] },
        { nombre: "Integrado Cl칤nico II", id: "TME171", prerreq: ["TME170"] }
      ],
      [
        { nombre: "Internado Profesional Microbiolog칤a/Parasitolog칤a Cl칤nica", id: "TME172", prerreq: ["TME147", "TME080"] },
        { nombre: "Internado Profesional Qu칤mica Cl칤nica", id: "TME173", prerreq: ["TME169"] },
        { nombre: "Internado Profesional Hematolog칤a Cl칤nica", id: "TME174", prerreq: ["TME076", "TME150B"] },
        { nombre: "Internado Profesional Medicina Transfusional", id: "TME175", prerreq: ["TME149"] },
        { nombre: "Actividad de Titulaci칩n", id: "TME144", prerreq: ["TME171"] }
      ]
    ];
    const aprobadas = new Set(JSON.parse(localStorage.getItem("asignaturasAprobadas") || "[]"));

    function guardarProgreso() {
      localStorage.setItem("asignaturasAprobadas", JSON.stringify([...aprobadas]));
    }

    function reiniciarMalla() {
      aprobadas.clear();
      guardarProgreso();
      crearMalla();
    }

    function crearMalla() {
      const contenedor = document.getElementById("malla");
      const resumen = document.getElementById("resumen");
      contenedor.innerHTML = "";

      let total = 0;
      let minSemestre = 11;

      malla.forEach((semestre, idx) => {
        const columna = document.createElement("div");
        columna.className = "semestre";
        columna.style.backgroundColor = coloresSemestre[idx % coloresSemestre.length];
        const titulo = document.createElement("h3");
        titulo.textContent = `Semestre ${idx + 1}`;
        columna.appendChild(titulo);

        semestre.forEach(asig => {
          total++;
          const boton = document.createElement("div");
          boton.className = "asignatura";
          boton.id = asig.id;
          boton.innerText = asig.nombre;

          const habilitada = asig.prerreq.every(id => aprobadas.has(id));
          if (aprobadas.has(asig.id)) {
            boton.classList.add("aprobada");
            if (idx + 1 < minSemestre) minSemestre = idx + 1;
          } else if (!habilitada) {
            boton.classList.add("bloqueada");
          }

          if (habilitada || aprobadas.has(asig.id)) {
            boton.addEventListener("click", () => toggleAprobada(asig));
          }

          columna.appendChild(boton);
        });

        contenedor.appendChild(columna);
      });

      const aprobadasTotal = aprobadas.size;
      const pendientes = total - aprobadasTotal;
      const porcentaje = total > 0 ? ((aprobadasTotal / total) * 100).toFixed(2) : 0;
      const nivelMinimo = aprobadasTotal === 0 ? "N/A" : minSemestre;

      resumen.innerHTML = `Asignaturas aprobadas: ${aprobadasTotal} | Pendientes: ${pendientes} | Porcentaje completado: ${porcentaje}% | Nivel m칤nimo aprobado: ${nivelMinimo}`;
    }

    function toggleAprobada(asig) {
      if (aprobadas.has(asig.id)) {
        aprobadas.delete(asig.id);
        limpiarDependencias(asig.id);
      } else {
        const habilitada = asig.prerreq.every(id => aprobadas.has(id));
        if (habilitada) {
          aprobadas.add(asig.id);
        }
      }
      guardarProgreso();
      crearMalla();
    }

    function limpiarDependencias(idDesmarcado) {
      malla.flat().forEach(asig => {
        if (asig.prerreq.includes(idDesmarcado) && aprobadas.has(asig.id)) {
          aprobadas.delete(asig.id);
          limpiarDependencias(asig.id);
        }
      });
    }

    crearMalla();
  </script>
</body>
</html>
